<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job arrays • rSubmitter</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Job arrays">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rSubmitter</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/config_file_instructions.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/job_arrays.html">Job arrays</a>
    </li>
    <li>
      <a href="../articles/job_submission_management.html">Job submission and management</a>
    </li>
    <li>
      <a href="../articles/quick_start.html">Quick-start guide</a>
    </li>
    <li>
      <a href="../articles/scratch.html">In construction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pablo-gar/rSubmitter/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Job arrays</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pablo-gar/rSubmitter//blob/master/vignettes/job_arrays.Rmd"><code>vignettes/job_arrays.Rmd</code></a></small>
      <div class="hidden name"><code>job_arrays.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>SLURM job arrays are an efficient way to submit multiple jobs that share the same requriments. They reduce the load on the scheduler by allowing one single submission for multiple jobs.</p>
<p>The <a href="https://pablo-gar.github.io/rSubmitter/reference/JobArray.html"><code>JobArray</code></a> class in rSubmitter implements SLURM job arrays in similar way to individual jobs from the <a href="https://pablo-gar.github.io/rSubmitter/reference/Job"><code>Job</code></a> class. So all the functionalities of the <code>Job</code> class are available for the <code>JobArray</code> class as well.</p>
<p>This tutorial describes the few particularities of the <code>JobArray</code> class over the <code>Job</code> class. It’s highly recommended to first go over the <code>Job</code> <a href="%22https://pablo-gar.github.io/rSubmitter/articles/job_submission_management.html%22">tutorial</a> before continuing.</p>
</div>
<div id="creating-a-job-array" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-job-array" class="anchor"></a>Creating a job array</h2>
<p>Similar to <code>Job</code>, a <code>JobArray</code> object is created using the the <code>JobArray$new()</code> constructor method. However compared to <code>Job$new()</code>, the first and only required argument is <code>commandList</code>: a list of command vectors where each vector corresponds to the commands of inidvidual jobs in the array.</p>
<p>For example if you want to create a job array with 3 independent jobs, it would look like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rSubmitter"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">bash_list_cmd &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">"echo Hello World"</span>, <span class="st">"sleep 30"</span>), <span class="co"># First job</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">                      <span class="kw">c</span>(<span class="st">"date"</span>, <span class="st">"sleep 20"</span>), <span class="co"># Second job</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">                      <span class="kw">c</span>(<span class="st">"ls ~"</span>, <span class="st">"du ~"</span>, <span class="st">"sleep 40"</span>) <span class="co"># Third job</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">                     )</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">my_job_array &lt;-<span class="st"> </span>JobArray<span class="op">$</span><span class="kw">new</span>(bash_list_cmd)</a></code></pre></div>
<p>After submission of this job array (using its <code>$submit()</code> method), three independent and parallel jobs will be executed. The first one prints <em>Hello World</em> to its STDOUT and idles for 30 seconds, the scondone prints the current date and time to a different STDOUT and idles for 20 min, and the last prints the contents and usage of your home folder in yet a different STDOUT.</p>
<div id="job-array-specifications" class="section level4">
<h4 class="hasAnchor">
<a href="#job-array-specifications" class="anchor"></a>Job array specifications</h4>
<p>All of the job array specifications are declared exactly the same as in a <code>Job</code> by passing them as arguments to <code>JobArray$new()</code>. These include:</p>
<ul>
<li>Job name (jobName)</li>
<li>Computing capabilitites
<ul>
<li>partition : character - Partition to use. Equivalent to –partition of SLURM sbatch</li>
<li>time : character - Time requested for job execution, one accepted format is “HH:MM:SS”. Equivalent to –time of SLURM sbatch</li>
<li>mem : character - Memory requested for job execution, one accepted format is “xG” or “xMB”. Equivalent to –mem of SLURM sbatch</li>
<li>proc : integer - Number of processors requested per task. Equivalent to –cpus-per-task of SLURM sbatch</li>
<li>totalProc : integer - Number of tasks requested for job. Equivalent to –ntasks of SLURM sbatch</li>
<li>nodes : integer - Number of nodes requested for job. Equivalent to –nodes of SLURM sbatch</li>
</ul>
</li>
<li>Working folder (outDir) to create STDERR, STDOUT and sbacth script files</li>
</ul>
</div>
<div id="stderr-stdout-and-slurm-batch-files" class="section level4">
<h4 class="hasAnchor">
<a href="#stderr-stdout-and-slurm-batch-files" class="anchor"></a>STDERR, STDOUT and SLURM batch files</h4>
<p>The the standard error, output files, and sbatch script are streamed into files in the specified <em>outDir</em> folder. Only one sbatch script will be created but each individual job in the array will have its own associated STDOUT and STDERR files. These files will have the form of <code>jobName\_[n].[err|out]</code> where n is the number of the corresponding job in the array.</p>
<p>You can change the folder where these files will be generated through the <code>outDir</code> argument of the <code>$new()</code> constructor method.</p>
</div>
</div>
<div id="submitting-a-job-array" class="section level2">
<h2 class="hasAnchor">
<a href="#submitting-a-job-array" class="anchor"></a>Submitting a job array</h2>
<p>Once you created a <code>Job</code> object you can submit it to SLURM using its method <code>$submit()</code>. This will create a sbatch script and submit it to the queue.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">my_job_array<span class="op">$</span><span class="kw">submit</span>()</a></code></pre></div>
</div>
<div id="monitoring-a-job-array" class="section level2">
<h2 class="hasAnchor">
<a href="#monitoring-a-job-array" class="anchor"></a>Monitoring a job array</h2>
<p>For a <code>JobArray</code> this achieved mainly identically as a <code>Job</code></p>
<p>The fist way is manually check the status of the jobs in the arrays by requesting a data.frame with states</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">my_job_array<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">last_state &lt;-<span class="st"> </span>my_job_array<span class="op">$</span><span class="kw">getState</span>()</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">last_state</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#        jobId                   jobName jobState</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co"># 1 24347700_3 rSubmitter_job_7305737665  RUNNING</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># 2 24347700_1 rSubmitter_job_7305737665  RUNNING</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># 3 24347700_2 rSubmitter_job_7305737665  RUNNING</span></a></code></pre></div>
<p>The <code>$wait()</code> method is also available for job arrays. One key difference is that if the <code>stopIfFailed</code> argument is set to <code>TRUE</code>, <code>$wait()</code> will throw and error and cancel all jobs in the array if one or more failed; if it is set to <code>FALSE</code> only a warning will be thrown and it will continue to wait for the rest of jobs to be completed. Moreover if one or more jobs failed it will print out the path to the STDERR and STDOUT of the individual job(s) that failed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">my_job_array<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">my_job_array<span class="op">$</span><span class="kw">wait</span>(<span class="dt">stopIfFailed =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#  2018-08-27 16:55:37 --- Cluster Status |  PENDING = 3 |</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#  2018-08-27 16:55:47 --- Cluster Status |  RUNNING = 3 |</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#  2018-08-27 16:57:20 --- Cluster Status |  COMPLETED = 2 |  TIMEOUT = 1 |</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co"># Warning message:</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># In my_job_array$submit()$wait() : </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># One or more jobs failed. Failed jobs SLURM files:</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co"># /home/users/paedugar/rSubmitter_job_7305737665_24347830_3.[err|out]</span></a></code></pre></div>
</div>
<div id="cancelling-a-job-array" class="section level2">
<h2 class="hasAnchor">
<a href="#cancelling-a-job-array" class="anchor"></a>Cancelling a job array</h2>
<p>Exactly the same as in <code>Job</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">my_job_array<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">my_job_array<span class="op">$</span><span class="kw">cancel</span>()</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># 2018-08-27 17:03:58 Cancelling 3 job(s)</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co"># 2018-08-27 17:03:58 Finished sending cancel signal</span></a></code></pre></div>
</div>
<div id="cleaning-job-associated-files" class="section level2">
<h2 class="hasAnchor">
<a href="#cleaning-job-associated-files" class="anchor"></a>Cleaning job-associated files</h2>
<p>Exactly the same as in <code>Job</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">my_job_array<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">my_job_array<span class="op">$</span><span class="kw">cancel</span>()</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">my_job_array<span class="op">$</span><span class="kw">clean</span>(<span class="dt">script =</span> <span class="ot">TRUE</span>, <span class="dt">out =</span> <span class="ot">TRUE</span>, <span class="dt">err =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code>$clean()</code> will throw an error if the job is submitted and it has not completed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li><a href="#creating-a-job-array">Creating a job array</a></li>
      <li><a href="#submitting-a-job-array">Submitting a job array</a></li>
      <li><a href="#monitoring-a-job-array">Monitoring a job array</a></li>
      <li><a href="#cancelling-a-job-array">Cancelling a job array</a></li>
      <li><a href="#cleaning-job-associated-files">Cleaning job-associated files</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Pablo E. Garcia-Nieto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
