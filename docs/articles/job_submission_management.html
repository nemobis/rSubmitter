<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job submission and management • rSubmitter</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Job submission and management">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rSubmitter</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/config_file_instructions.html">Configuration</a>
    </li>
    <li>
      <a href="../articles/job_arrays.html">Job arrays</a>
    </li>
    <li>
      <a href="../articles/job_submission_management.html">Job submission and management</a>
    </li>
    <li>
      <a href="../articles/quick_start.html">Quick-start guide</a>
    </li>
    <li>
      <a href="../articles/scratch.html">In construction</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pablo-gar/rSubmitter/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Job submission and management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pablo-gar/rSubmitter//blob/master/vignettes/job_submission_management.Rmd"><code>vignettes/job_submission_management.Rmd</code></a></small>
      <div class="hidden name"><code>job_submission_management.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>The <a href="https://pablo-gar.github.io/rSubmitter/reference/Job.html"><code>Job</code></a> class in rSubmitter allows for submission and management of cluster jobs in a SLURM cluster from R. It does so in a semi-interactive fashion providing fleixibility to work in a SLURM cluster either from an interactive R session or from an automated R script.</p>
<p>This tutorial describes in full detail the capabilities of the <code>Job</code> class</p>
</div>
<div id="creating-a-job" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-job" class="anchor"></a>Creating a job</h2>
<p>The first step to submit a job is to create an object of the <code>Job</code> class with some relevant information regarding the commands to execute and the SLURM parameters associated to the job.</p>
<p>For example, if you want to submit a job with 8Gb of memory requested, you create a Job object like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rSubmitter"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">bash_cmd &lt;-<span class="st"> "echo Hello World"</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">my_job &lt;-<span class="st"> </span>Job<span class="op">$</span><span class="kw">new</span>(bash_cmd, <span class="dt">mem =</span> <span class="st">"8G"</span>)</a></code></pre></div>
<p>The <code>Job</code> class is an R6 class, hence the use of the <code>Job$new()</code> constructor method to create a new object. <code>my_job</code> now contains all the information necessary to submit a job with 8Gb and a simple “Hello world” bash command.</p>
<p>Being an R6 class object, <code>my_job</code> contains several methods to manipulate or execute actions related to this specific instance. These methods are called using the <code>$</code> operator, for example <code>my_job$submit()</code> submits the job associated to this object.</p>
<p>Before we explore the submission process let’s dive into the options available for you when creating a new Job, since you won’t be able to change them in the future.</p>
<div id="commands-to-execute" class="section level4">
<h4 class="hasAnchor">
<a href="#commands-to-execute" class="anchor"></a>Commands to execute</h4>
<p>The main prupose of creating and submitting a job is to execute one or more commands in a cluster. When creating a job the only required argument is <code>commandVector</code>, which is the first positional argument too. This has to be a character vector with one or more bash commands to be executed in the cluster, for example this job will create a “Hello World” file and then will copy it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rSubmitter"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">bash_cmd &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"echo Hello World &gt; temp_file.txt"</span>, <span class="st">"cp temp_file.txt temp_file_copy.txt"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">my_job &lt;-<span class="st"> </span>Job<span class="op">$</span><span class="kw">new</span>(<span class="dt">commandVector =</span> bash_cmd)</a></code></pre></div>
<p>Alternatively you can provide a single string with commands separated by “;” following the bash syntax.</p>
<p>Currently the commands can only be bash commands and assumes that <code>/bin/bash</code> is available.</p>
</div>
<div id="job-name" class="section level4">
<h4 class="hasAnchor">
<a href="#job-name" class="anchor"></a>Job name</h4>
<p>You can specify a job name through the argument <code>jobName</code> of the <code>$new()</code> constructor method. This is useful as rSubmitter will use it as a prefix for output files, see <a href="#stderr-stdout-and-slurm-batch-script">below</a> for more details.</p>
<p>The default job name is randomly generated with the form <code>rSubmitter_job_[random_alphanumeric]</code></p>
</div>
<div id="requesting-computing-capabilities" class="section level4">
<h4 class="hasAnchor">
<a href="#requesting-computing-capabilities" class="anchor"></a>Requesting computing capabilities</h4>
<p>The computing capabilities required for your job have to be requested at the time of creation. These are passed as arguments to the <code>$new()</code> constructor method, currently the following options are available, you can check the <a href="https://pablo-gar.github.io/rSubmitter/reference/Job.html#method-description">reference</a> to see the most updated list of options.</p>
<ul>
<li>partition : character - Partition to use. Equivalent to –partition of SLURM sbatch</li>
<li>time : character - Time requested for job execution, one accepted format is “HH:MM:SS”. Equivalent to –time of SLURM sbatch</li>
<li>mem : character - Memory requested for job execution, one accepted format is “xG” or “xMB”. Equivalent to –mem of SLURM sbatch</li>
<li>proc : integer - Number of processors requested per task. Equivalent to –cpus-per-task of SLURM sbatch</li>
<li>totalProc : integer - Number of tasks requested for job. Equivalent to –ntasks of SLURM sbatch</li>
<li>nodes : integer - Number of nodes requested for job. Equivalent to –nodes of SLURM sbatch</li>
</ul>
</div>
<div id="stderr-stdout-and-slurm-batch-files" class="section level4">
<h4 class="hasAnchor">
<a href="#stderr-stdout-and-slurm-batch-files" class="anchor"></a>STDERR, STDOUT and SLURM batch files</h4>
<p>The the standard error, output files, and sbatch script are streamed into files in the current working directory with the file name of the form <code>jobName.[err|out|sbatch]</code>; where jobName can be specified when creating the <code>Job</code> object (<a href="#job-name">see above</a>)</p>
<p>You can change the folder where these files will be generated through the <code>outDir</code> argument of the <code>$new()</code> constructor method.</p>
</div>
<div id="full-exmaple" class="section level4">
<h4 class="hasAnchor">
<a href="#full-exmaple" class="anchor"></a>Full exmaple</h4>
<p>This example demonstrates the use of all avaialbe options when creating a new <code>Job</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rSubmitter"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">bash_cmd &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"echo Hello World"</span>, <span class="st">"echo Goodbye"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">my_job &lt;-<span class="st"> </span>Job<span class="op">$</span><span class="kw">new</span>(<span class="dt">commandVector =</span> bash_cmd,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                  <span class="dt">jobName =</span> <span class="st">"dummy_job"</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                  <span class="dt">outDir =</span> <span class="st">"~"</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                  <span class="dt">partition =</span> <span class="st">"normal"</span>, <span class="dt">time =</span> <span class="st">"2:00:00"</span>, <span class="dt">mem =</span> <span class="st">"8G"</span>, </a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                  <span class="dt">proc =</span> <span class="dv">1</span>, <span class="dt">totalProc =</span> <span class="dv">1</span>, <span class="dt">nodes =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Eventually the following files will be created (after job submission)</p>
<pre><code>~/dummy_job.out
~/dummy_job.err
~/dummy_job.sbatch</code></pre>
</div>
</div>
<div id="submitting-a-job" class="section level2">
<h2 class="hasAnchor">
<a href="#submitting-a-job" class="anchor"></a>Submitting a job</h2>
<p>Once you created a <code>Job</code> object you can submit it to SLURM using its method <code>$submit()</code>. This will create a sbatch script and submit it to the queue.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rSubmitter"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">bash_cmd &lt;-<span class="st"> "echo Hello World"</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">my_job &lt;-<span class="st"> </span>Job<span class="op">$</span><span class="kw">new</span>(bash_cmd, <span class="dt">mem =</span> <span class="st">"2G"</span>, <span class="dt">time =</span> <span class="st">"2:00"</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">my_job<span class="op">$</span><span class="kw">submit</span>()</a></code></pre></div>
</div>
<div id="monitoring-a-job" class="section level2">
<h2 class="hasAnchor">
<a href="#monitoring-a-job" class="anchor"></a>Monitoring a job</h2>
<p>After submission there are two main ways to monitor the status of a job. You can manually inspect the state of a job by using the method <code>$getState()</code> which will return a data.frame with three columns: the SLURM job id, the job name and its current state.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">my_job<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">last_state &lt;-<span class="st"> </span>my_job<span class="op">$</span><span class="kw">getState</span>()</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">last_state</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#     jobId                     jobName   jobState</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#1 24339250   rSubmitter_job_1324462985    PENDING</span></a></code></pre></div>
<p>The second and more recommended way to monitor a job is to use the <code>$wait()</code> method. This will put R in idle until the job is finished or failed, printing the status of the job every N seconds (N can be set in the <a href="%22https://pablo-gar.github.io/rSubmitter/articles/config_file_instructions.html%22">config file</a>). For convience if the job fails <code>$wait()</code> will throw an error.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">my_job<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">my_job<span class="op">$</span><span class="kw">wait</span>()</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co"># 2018-08-27 15:17:25 --- Cluster Status |  PENDING = 1 |</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># 2018-08-27 15:20:53 --- Cluster Status |  COMPLETED = 1 |</span></a></code></pre></div>
</div>
<div id="cancelling-a-job" class="section level2">
<h2 class="hasAnchor">
<a href="#cancelling-a-job" class="anchor"></a>Cancelling a job</h2>
<p>You can cancel any submitted jobs using their <code>$cancel()</code> method. This will send a kill signal to a submitted job associated to this object. After the signal has been sent SLURM can take some time before completing the request.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">my_job<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">my_job<span class="op">$</span><span class="kw">cancel</span>()</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co"># 2018-08-27 15:18:10 Cancelling 1 job(s)</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co"># 2018-08-27 15:18:10 Finished sending cancel signal</span></a></code></pre></div>
</div>
<div id="cleaning-job-associated-files" class="section level2">
<h2 class="hasAnchor">
<a href="#cleaning-job-associated-files" class="anchor"></a>Cleaning job-associated files</h2>
<p>After a job is completed you may want to remove all the files created by rSubmitter that are associated to the job. The three files that are generated are STDOUT, STDERR and the sbatch script. You can delete one or more of these using the <code>$clean()</code> method and specifying which ones you’d like to remove. By default all three are removed.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">my_job<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">my_job<span class="op">$</span><span class="kw">cancel</span>()</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">my_job<span class="op">$</span><span class="kw">clean</span>(<span class="dt">script =</span> <span class="ot">TRUE</span>, <span class="dt">out =</span> <span class="ot">TRUE</span>, <span class="dt">err =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><code>$clean()</code> will throw an error if the job is submitted and it has not completed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li><a href="#creating-a-job">Creating a job</a></li>
      <li><a href="#submitting-a-job">Submitting a job</a></li>
      <li><a href="#monitoring-a-job">Monitoring a job</a></li>
      <li><a href="#cancelling-a-job">Cancelling a job</a></li>
      <li><a href="#cleaning-job-associated-files">Cleaning job-associated files</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Pablo E. Garcia-Nieto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
