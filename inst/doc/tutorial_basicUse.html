<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>1. Quick-start guide</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">1. Quick-start guide</h1>



<div id="intro" class="section level2">
<h2>Intro</h2>
<p>rSubmmiter is a package that allows simple communication between R and a SLURM cluster to achieve three main tasks:</p>
<ol style="list-style-type: decimal">
<li>Easy submission, monitoring and management of individual cluster jobs.</li>
<li>Easy and fast submission of many jobs, by implementing SLURM arrays.</li>
<li>Seamlessly lapply (loop) parallelization.</li>
</ol>
<p>This section demonstrates the simplest way to implement these tasks.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>Currently rSubmitter can only be installed via the R devtools package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;devtools&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">install_github</span>(<span class="st">&quot;pablo-gar/rSubmitter&quot;</span>)</a></code></pre></div>
</div>
<div id="single-job-sumbssion" class="section level2">
<h2>Single job sumbssion</h2>
<p>The creation, management and submission of individual jobs is achieved by the use of the <code>Job</code> class. The first step is to create an object of the <code>Job</code> class by using the <code>Job$new()</code> constructor method. The only required argument is a character vector, where each element is an independet shell command. Then you can submit the job to the SLURM cluster using the <code>$submit()</code> method of a <code>Job</code> object. And you can use the <code>$wait()</code> method to wait until a job is completed or failed.</p>
<p>On its simplest form the submission of a job looks like this</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;rSubmitter&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">myJob &lt;-<span class="st"> </span>Job<span class="op">$</span><span class="kw">new</span>(<span class="dt">commandVector =</span> <span class="kw">c</span>(<span class="st">&quot;echo hola world!&quot;</span>, <span class="st">&quot;sleep 30&quot;</span>))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">myJob<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">myJob<span class="op">$</span><span class="kw">wait</span>()</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#  2018-04-23 18:22:35 --- Cluster Status |  PENDING = 1 |</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#  2018-04-23 18:22:40 --- Cluster Status |  RUNNING = 1 |</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#  2018-04-23 18:23:30 --- Cluster Status |  COMPLETED = 1 |</span></a></code></pre></div>
<p>The STDERR and STDOUT are streamed to files of the form <code>rSubmitter_job_[randomNumber].[err|out]</code> in the current working directory. Refer to the advanced section if you wish to select the destination and names of these files, as well as to set the system requirements of memory, time, cpus, nodes, etc.</p>
<p>You can also access the full documentation of the Job class from R:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">?Job</a></code></pre></div>
</div>
<div id="efficient-multiple-job-sumbssion" class="section level2">
<h2>Efficient multiple job sumbssion</h2>
<p>To submit many jobs at once in an efficient way you can use the <code>JobArray</code> class that implments the SLURM arrays. Similar to the <code>Job</code> class, you first create a JobArray object with the <code>JobArray$new()</code> constructor method. The difference is that you have to pass a list of character vectors, where each element of the list is a vector of commands which wil be submmitted as independent jobs. All jobs in the array will have the same system requirements of memory, cpus, etc. Identically to the <code>Job</code> class, you can submit the array using the <code>$submit()</code> method, and you can use the <code>$wait()</code> method to wait until all jobs are completed or one or more fail.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;rSubmitter&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">commands &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>( <span class="co"># First Job</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                    <span class="st">&quot;echo hola&quot;</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                    <span class="st">&quot;sleep 20&quot;</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                   ),</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                 <span class="kw">c</span>( <span class="co"># Second Job</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                   <span class="st">&quot;echo adios&quot;</span>,</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                   <span class="st">&quot;sleep 60&quot;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                 )</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">               )</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">jobArray &lt;-<span class="st"> </span>JobArray<span class="op">$</span><span class="kw">new</span>(<span class="dt">commandList =</span> commands)</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">jobArray<span class="op">$</span><span class="kw">submit</span>()</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">jobArray<span class="op">$</span><span class="kw">wait</span>()</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#   2018-04-25 17:49:30 --- Cluster Status |  PENDING = 2 |</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#   2018-04-25 17:49:45 --- Cluster Status |  RUNNING = 2 |</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#   2018-04-25 17:50:50 --- Cluster Status |  COMPLETED = 2 |</span></a></code></pre></div>
<p>The STDERR and STDOUT are streamed to files of the form <code>rSubmitter_job_[randomNumber]_[jobNumber].[err|out]</code> in the current working directory. Refer to the advanced section if you wish to select the destination and names of these files, as well as to set the system requirements of memory, time, cpus, nodes, etc.</p>
<p>You can also access the full documentation of the JobArray class from R:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">?JobArray</a></code></pre></div>
</div>
<div id="lapply-parallelization-loop-parallelization" class="section level2">
<h2>Lapply parallelization (loop parallelization)</h2>
<p>lapply is an R-base function that applies a function <code>FUN</code> to each element of a list or vector (similar to <code>map()</code> in python). It’s one of the R ways of performing loops.</p>
<p>For example this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, as.character)</a></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    x[[i]] &lt;-<span class="st"> </span><span class="kw">as.character</span>(i)</a></code></pre></div>
<p>rSubmitter comes with an implementation of lapply, <code>superApply</code>, that enables parallelization of lapply function calls using a SLURM cluster. Under the hood, it implements the JobArray class (described above) along with some complicated file management to partition one lapply call into many indepent ones that are parallely executed, then when they are all done the results of indivudal calls are compiled and returned to the user.</p>
<p>The number of parallel tasks is defined in the <code>tasks</code> argument of <code>superApply</code>, <strong>on its simplest form a parallel lapply call looks like this:</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">myFun &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="kw">return</span>(<span class="kw">rep</span>(x, <span class="dv">3</span>)) </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;rSubmitter&quot;</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">x &lt;-<span class="st"> </span><span class="kw">superApply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, myFun, <span class="dt">tasks =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#   2018-05-04 15:29:34 Partitioning function calls </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#   2018-05-04 15:29:35 Submmiting parallel Jobs</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#   2018-05-04 15:29:40 --- Cluster Status |  PENDING = 4 |</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#   2018-05-04 15:29:45 --- Cluster Status |  COMPLETED = 4 |</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#   2018-05-04 15:29:45 Merging parellel results</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#   2018-05-04 15:29:45 Merge done</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#   2018-05-04 15:29:46 Cleaning partitioned data</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#   2018-05-04 15:29:47 Cleaning done</span></a></code></pre></div>
<p>This will partition the lapply call into 4 different ones, each having an equally distributed elements of <code>1:100</code>, this partitions will be submitted as independents jobs, the results will be compiled and returned without the need of doing anything else.</p>
<p>It is important to note that not all systems come with an out-of-the-box R executable, and since superApply performs independent R calls in the SLURM cluster then you have to make sure that these R calls can be executed. If you have to execute any commands from your shell enviroment to be able to open the R interpreter, then you have to include those commands in the <code>extraBashLines</code> argument of <code>superApply</code></p>
<p>For example, if in order to execute R in your system you usally do:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1">$ <span class="ex">module</span> load R</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">$ <span class="ex">R</span></a></code></pre></div>
<p>Then you have to execute superApply like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">superApply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, myFun, <span class="dt">tasks =</span> <span class="dv">4</span>, <span class="dt">extraBashLines =</span> <span class="st">&quot;module load R&quot;</span>)</a></code></pre></div>
<p>You can see the full documentation of superApply from R:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">?superApply</a></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
